
// I want to use DotNet 10 on my system, 
// but building .dacpacs only works with DotNet 8,
// So use Docker to generate the .dacpac in bin/Debug

docker run --rm -v $(pwd)/CoresHubDB:/project mcr.microsoft.com/dotnet/sdk:8.0 \
    bash -c "cd /project && dotnet build CoresHubDB.sqlproj"



// Now to publish

~/sqlpackage/sqlpackage /Action:Publish \
    /SourceFile:bin/Debug/CoresHubDB.dacpac \
    /TargetServerName:cpp-poly6-dev.database.usgovcloudapi.net,1433 \
    /TargetDatabaseName:DCAP \
    /TargetUser:cppazureuser \
    /TargetPassword:VeryMuchSecure14\! \
    /TargetTrustServerCertificate:True

// alt w/ Docker
docker run --rm \
    -v "$(pwd)/CoresHubDB/bin/Debug:/dacpac" \
    mcr.microsoft.com/dotnet/sdk:8.0 \
    bash -c "dotnet tool install -g microsoft.sqlpackage && \
    /root/.dotnet/tools/sqlpackage \
    /Action:Publish \
    /SourceFile:/dacpac/CoresHubDB.dacpac \
    /TargetServerName:cpp-poly6-dev.database.usgovcloudapi.net,1433 \
    /TargetDatabaseName:DCAP \
    /TargetUser:cppazureuser \
    /TargetPassword:'VeryMuchSecure14!' \
    /TargetTrustServerCertificate:True"


// Generate the deployment script, for validation
~/sqlpackage/sqlpackage /Action:Script \
    /SourceFile:bin/Debug/CoresHubDB.dacpac \
    /TargetServerName:cpp-poly6-dev.database.usgovcloudapi.net,1433 \
    /TargetDatabaseName:DCAP \
    /TargetUser:cppazureuser \
    /TargetPassword:VeryMuchSecure14\! \
    /TargetTrustServerCertificate:True \
    /OutputPath:deploy-script.sql


// Import a new .dacpac
// doesn't work
~/sqlpackage/sqlpackage /Action:Import \
    /SourceFile:dcap-dev-export.bacpac \
    /TargetConnectionString:"Server=cpp-poly6-dev.database.usgovcloudapi.net,1433;User Id=sa;Password=VeryMuchSecure14\!;TrustServerCertificate=True;" \
    /p:ExcludeObjectTypes=ExternalDataSources\;Credentials
